(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React;var n=e.n(t);const o=window.wp.htmlEntities,r=window.wc.wcBlocksRegistry,a=window.wc.wcSettings;var c=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function c(e){try{l(o.next(e))}catch(e){a(e)}}function i(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}l((o=o.apply(e,t||[])).next())}))};const i=(0,a.getSetting)("ledyer_payments_data",{}),l=i.title||"Ledyer Payments",s=i.enabled||!1,d=i.description||"",u=i.iconurl||!1,y=i.ledyerpaymentparams||{},m=({eventRegistration:e})=>{const{onCheckoutSuccess:n}=e;return(0,t.useEffect)((()=>{const e=n((()=>!0));return w(),e}),[n]),null},w=()=>c(void 0,void 0,void 0,(function*(){const e=y.submitOrderUrl;try{const t=yield fetch(e,{method:"POST",body:""}),n=yield t.json(),{order_key:o,customer:r}=n;yield h(o,r)}catch(e){console.error(e)}})),h=(e,t)=>c(void 0,void 0,void 0,(function*(){const{gatewayId:n,sessionId:o}=y,r={customer:Object.assign({},t),sessionId:o},a=yield window.ledyer.payments.api.authorize(r);if(a&&"authorized"===a.state){const t=a.authorizationToken,{state:n}=a,{createOrderUrl:o,createOrderNonce:r}=y;try{const a=yield fetch(o,{method:"POST",body:new URLSearchParams({state:n,order_key:e,auth_token:t,nonce:r})}),c=yield a.json(),{data:{location:i}}=c;window.location=i}catch(e){console.log(e)}}})),p=({eventRegistration:e})=>n().createElement("div",null,n().createElement("p",null,(0,o.decodeEntities)(d)),n().createElement(m,{eventRegistration:e})),v={name:"ledyer_payments",label:n().createElement((()=>{const e=u?n().createElement("img",{src:u,alt:l}):null;return n().createElement("span",{className:"lp-block-label"},e,l)}),null),content:n().createElement(p,null),edit:n().createElement(p,null),placeOrderButtonLabel:"Pay with Ledyer",canMakePayment:()=>s,ariaLabel:l};(0,r.registerPaymentMethod)(v)})();