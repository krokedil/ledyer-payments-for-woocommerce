(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React;var n=e.n(t);const r=window.wp.htmlEntities,o=window.wc.wcBlocksRegistry,a=window.wc.wcSettings;var c=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function c(e){try{l(r.next(e))}catch(e){a(e)}}function i(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}l((r=r.apply(e,t||[])).next())}))};const i=(0,a.getSetting)("ledyer_payments_data",{}),l=i.title||"Ledyer Payments",s=i.enabled||!1,d=i.description||"",u=i.iconurl||!1,m=i.ledyerpaymentsparams||{},y=({eventRegistration:e,companyNumberRef:n,setNotice:r})=>{const{onCheckoutSuccess:o}=e;return(0,t.useEffect)((()=>o((e=>c(void 0,void 0,void 0,(function*(){yield p(n,e.orderId,e.customerId,r)}))))),[o]),null},p=(e,t,n,r)=>c(void 0,void 0,void 0,(function*(){var o;const a=null===(o=e.current)||void 0===o?void 0:o.value.trim();if(!a||!a.length)throw r("Company number is missing"),new Error("Missing company number.");const{sessionId:c}=m,i={customer:Object.assign({},n),sessionId:c},l=yield window.ledyer.payments.api.authorize(i);if(l)if("authorized"===l.state){const e=l.authorizationToken,{state:n}=l,{createOrderUrl:o,createOrderNonce:a}=m;try{const r=yield fetch(o,{method:"POST",body:new URLSearchParams({state:n,order_key:t,auth_token:e,nonce:a})}),c=yield r.json(),{data:{location:i}}=c;window.location=i}catch(e){throw r("The payment was successful, but the order could not be created."),new Error("The payment was successful, but the order could not be created.")}}else if("awaitingSignatory"===l.state){const{pendingPaymentUrl:e,pendingPaymentNonce:n}=m;try{const r=yield fetch(e,{method:"POST",body:new URLSearchParams({order_key:t,nonce:n})}),o=yield r.json(),{data:{location:a}}=o;window.location=a}catch(e){throw r("The payment is pending payment. Failed to redirect to order received page."),new Error("The payment is pending payment. Failed to redirect to order received page.")}}})),w=({message:e})=>{const r=(0,t.useRef)(null);return(0,t.useEffect)((()=>{r.current&&r.current.scrollIntoView({behavior:"smooth"})}),[e]),n().createElement("div",{ref:r,className:"woocommerce-NoticeGroup"},n().createElement("ul",{className:"woocommerce-error",role:"alert"},n().createElement("li",null,e)))},h=({eventRegistration:e})=>{const[o,a]=(0,t.useState)(null),c=(0,t.useRef)(null);return n().createElement("div",null,o&&n().createElement(w,{message:o}),n().createElement("p",null,(0,r.decodeEntities)(d)),n().createElement(y,{eventRegistration:e,companyNumberRef:c,setNotice:a}),n().createElement("input",{type:"text",className:"input-text",name:"billing_company_number_block",id:"billing_company_number_block",placeholder:"Company number",defaultValue:"",ref:c,required:!0}))},f={name:"ledyer_payments",label:n().createElement((()=>{const e=u?n().createElement("img",{src:u,alt:l}):null;return n().createElement("span",{className:"lp-block-label"},e,l)}),null),content:n().createElement(h,null),edit:n().createElement(h,null),placeOrderButtonLabel:"Pay with Ledyer",canMakePayment:()=>s,ariaLabel:l};(0,o.registerPaymentMethod)(f)})();