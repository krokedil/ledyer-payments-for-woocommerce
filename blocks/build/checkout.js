(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var l in t)e.o(t,l)&&!e.o(n,l)&&Object.defineProperty(n,l,{enumerable:!0,get:t[l]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=window.React;var t=e.n(n);const l=window.wp.htmlEntities,o=window.wc.wcBlocksRegistry,a=window.wc.wcSettings;var s=function(e,n,t,l){return new(t||(t=Promise))((function(o,a){function s(e){try{i(l.next(e))}catch(e){a(e)}}function r(e){try{i(l.throw(e))}catch(e){a(e)}}function i(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,r)}i((l=l.apply(e,n||[])).next())}))};const r=(0,a.getSetting)("ledyer_payments_data",{}),i=r.title||"Ledyer Payments",c=r.enabled||!1,u=r.description||"",d=r.iconurl||!1,m=r.ledyerpaymentsparams||{},p=({organizationNumber:e,props:t})=>{const{onCheckoutSuccess:l}=t.eventRegistration,{emitResponse:o}=t,{billingData:a}=t.billing,{shippingAddress:r}=t.shippingData;return(0,n.useEffect)((()=>l((n=>s(void 0,void 0,void 0,(function*(){const{orderId:t}=n;return yield y(t,e,a,r,o)}))))),[l]),null},y=(e,n,t,l,o)=>s(void 0,void 0,void 0,(function*(){var a;const s=null===(a=n.current)||void 0===a?void 0:a.value.trim();if(!s||!s.length)return{type:o.responseTypes.ERROR,message:"Company number is missing.",messageContext:o.noticeContexts.CHECKOUT};const{sessionId:r}=m,i=v(t,l,s,r),c=yield window.ledyer.payments.api.authorize(i);if(c){if("authorized"===c.state){const n=c.authorizationToken,{state:t}=c,{createOrderUrl:l,createOrderNonce:a}=m;try{const s=yield fetch(l,{method:"POST",body:new URLSearchParams({state:t,order_key:e,auth_token:n,nonce:a})}),r=yield s.json(),{data:{location:i}}=r;return window.location=i,{type:o.responseTypes.SUCCESS}}catch(e){return{type:o.responseTypes.ERROR,message:"The payment was successful, but the order could not be created.",messageContext:o.noticeContexts.CHECKOUT}}}else if("awaitingSignatory"===c.state){const{pendingPaymentUrl:n,pendingPaymentNonce:t}=m;try{const l=yield fetch(n,{method:"POST",body:new URLSearchParams({order_key:e,nonce:t})}),a=yield l.json(),{data:{location:s}}=a;return window.location=s,{type:o.responseTypes.SUCCESS}}catch(e){return{type:o.responseTypes.ERROR,message:"The payment is pending payment. Failed to redirect to order received page.",messageContext:o.noticeContexts.CHECKOUT}}}return{type:o.responseTypes.ERROR,message:"The payment was not successful. Not authorized.",messageContext:o.noticeContexts.CHECKOUT}}return{type:o.responseTypes.ERROR,message:"The payment was not successful. Not authorization response received.",messageContext:o.noticeContexts.CHECKOUT}})),v=(e,n,t,l)=>({customer:{companyId:t||null,email:(null==e?void 0:e.email)||null,firstName:(null==e?void 0:e.first_name)||null,lastName:(null==e?void 0:e.last_name)||null,phone:(null==e?void 0:e.phone)||null,reference1:"",reference2:"",billingAddress:{attentionName:(null==e?void 0:e.first_name)||null,city:(null==e?void 0:e.city)||null,companyName:(null==e?void 0:e.company)||null,country:(null==e?void 0:e.country)||null,postalCode:(null==e?void 0:e.postcode)||null,streetAddress:(null==e?void 0:e.address_1)||null},shippingAddress:{attentionName:(null==n?void 0:n.first_name)||null,city:(null==n?void 0:n.city)||null,companyName:(null==n?void 0:n.company)||null,country:(null==n?void 0:n.country)||null,postalCode:(null==n?void 0:n.postcode)||null,streetAddress:(null==n?void 0:n.address_1)||null,contact:{email:(null==e?void 0:e.email)||null,firstName:(null==n?void 0:n.first_name)||null,lastName:(null==n?void 0:n.last_name)||null,phone:(null==n?void 0:n.phone)||null}}},sessionId:l||null}),h=e=>{const o=(0,n.useRef)(null);return t().createElement("div",null,t().createElement("p",null,(0,l.decodeEntities)(u)),t().createElement(p,{props:e,organizationNumber:o}),t().createElement("input",{type:"text",className:"input-text",name:"billing_company_number_block",id:"billing_company_number_block",placeholder:"Company number",defaultValue:"",ref:o,required:!0}))},g={name:"ledyer_payments",label:t().createElement((()=>{const e=d?t().createElement("img",{src:d,alt:i}):null;return t().createElement("span",{className:"lp-block-label"},e,i)}),null),content:t().createElement(h,null),edit:t().createElement(h,null),placeOrderButtonLabel:"Pay with Ledyer",canMakePayment:()=>c,ariaLabel:i};(0,o.registerPaymentMethod)(g)})();