(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var l in t)e.o(t,l)&&!e.o(n,l)&&Object.defineProperty(n,l,{enumerable:!0,get:t[l]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=window.React;var t=e.n(n);const l=window.wp.htmlEntities,o=window.wc.wcBlocksRegistry,r=window.wc.wcSettings;var a=function(e,n,t,l){return new(t||(t=Promise))((function(o,r){function a(e){try{s(l.next(e))}catch(e){r(e)}}function i(e){try{s(l.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,i)}s((l=l.apply(e,n||[])).next())}))};const i=(0,r.getSetting)("ledyer_payments_data",{}),s=i.title||"Ledyer Payments",c=i.enabled||!1,u=i.description||"",d=i.iconurl||!1,m=i.ledyerpaymentsparams||{},p=({organizationNumber:e,reference1:t,reference2:l,props:o})=>{const{onCheckoutSuccess:r}=o.eventRegistration,{emitResponse:i}=o,{billingData:s}=o.billing,{shippingAddress:c}=o.shippingData;return(0,n.useEffect)((()=>r((n=>a(void 0,void 0,void 0,(function*(){const{orderId:o}=n,r=n.processingResponse.paymentDetails.order_key;return yield y(o,r,e,t,l,s,c,i)}))))),[r]),null},y=(e,n,t,l,o,r,i,s)=>a(void 0,void 0,void 0,(function*(){var a,c,u,d,p;const y=null===(a=t.current)||void 0===a?void 0:a.value.trim(),f=(null===(u=null===(c=l.current)||void 0===c?void 0:c.value)||void 0===u?void 0:u.trim())||"",h=(null===(p=null===(d=o.current)||void 0===d?void 0:d.value)||void 0===p?void 0:p.trim())||"";if(!y||!y.length)return{type:s.responseTypes.ERROR,message:"Company number is missing.",messageContext:s.noticeContexts.CHECKOUT};const{sessionId:g}=m,w=v(e,r,i,y,f,h,g),_=yield window.ledyer.payments.api.authorize(w);if(_){if("authorized"===_.state){const e=_.authorizationToken,{state:t}=_,{createOrderUrl:l,createOrderNonce:o}=m;try{const r=yield fetch(l,{method:"POST",body:new URLSearchParams({state:t,order_key:n,billing_company_number:y,auth_token:e,nonce:o})}),a=yield r.json(),{data:{location:i}}=a;return window.location=i,{type:s.responseTypes.SUCCESS}}catch(e){return{type:s.responseTypes.ERROR,message:"The payment was successful, but the order could not be created.",messageContext:s.noticeContexts.CHECKOUT}}}else if("awaitingSignatory"===_.state){const{pendingPaymentUrl:e,pendingPaymentNonce:t}=m;try{const l=yield fetch(e,{method:"POST",body:new URLSearchParams({order_key:n,nonce:t})}),o=yield l.json(),{data:{location:r}}=o;return window.location=r,{type:s.responseTypes.SUCCESS}}catch(e){return{type:s.responseTypes.ERROR,message:"The payment is pending payment. Failed to redirect to order received page.",messageContext:s.noticeContexts.CHECKOUT}}}return{type:s.responseTypes.ERROR,message:"The payment was not successful. Not authorized.",messageContext:s.noticeContexts.CHECKOUT}}return{type:s.responseTypes.ERROR,message:"The payment was not successful. Not authorization response received.",messageContext:s.noticeContexts.CHECKOUT}})),v=(e,n,t,l,o,r,a)=>({customer:{companyId:l||null,email:(null==n?void 0:n.email)||null,firstName:(null==n?void 0:n.first_name)||null,lastName:(null==n?void 0:n.last_name)||null,phone:(null==n?void 0:n.phone)||null,reference1:o||"",reference2:r||"",billingAddress:{attentionName:(null==n?void 0:n.first_name)||null,city:(null==n?void 0:n.city)||null,companyName:(null==n?void 0:n.company)||null,country:(null==n?void 0:n.country)||null,postalCode:(null==n?void 0:n.postcode)||null,streetAddress:(null==n?void 0:n.address_1)||null},shippingAddress:{attentionName:(null==t?void 0:t.first_name)||null,city:(null==t?void 0:t.city)||null,companyName:(null==t?void 0:t.company)||null,country:(null==t?void 0:t.country)||null,postalCode:(null==t?void 0:t.postcode)||null,streetAddress:(null==t?void 0:t.address_1)||null,contact:{email:(null==n?void 0:n.email)||null,firstName:(null==t?void 0:t.first_name)||null,lastName:(null==t?void 0:t.last_name)||null,phone:(null==t?void 0:t.phone)||null}}},sessionId:a||null}),f=e=>{const o=(0,n.useRef)(null),r=(0,n.useRef)(null),a=(0,n.useRef)(null);return t().createElement("div",null,t().createElement("p",null,(0,l.decodeEntities)(u)),t().createElement(p,{props:e,organizationNumber:o,reference1:r,reference2:a}),t().createElement("input",{type:"text",className:"input-text",name:"billing_company_number_block",id:"billing_company_number_block",placeholder:"Company number",defaultValue:"",ref:o,required:!0,style:{width:"100%",marginBottom:"10px"}}),t().createElement("input",{type:"text",className:"input-text",name:"reference_1_block",id:"reference_1_block",placeholder:"Reference 1",defaultValue:"",ref:r,required:!0,style:{width:"100%",marginBottom:"10px"}}),t().createElement("input",{type:"text",className:"input-text",name:"reference_2_block",id:"reference_2_block",placeholder:"Reference 2",defaultValue:"",ref:a,required:!0,style:{width:"100%",marginBottom:"10px"}}))},h={name:"ledyer_payments",label:t().createElement((()=>{const e=d?t().createElement("img",{src:d,alt:s}):null;return t().createElement("span",{className:"lp-block-label"},e,s)}),null),content:t().createElement(f,null),edit:t().createElement(f,null),placeOrderButtonLabel:"Pay with Ledyer",canMakePayment:()=>c,ariaLabel:s};(0,o.registerPaymentMethod)(h)})();